<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OmniVPN</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –°—Ç–∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; color: #fff; height: 100%; width: 100%; overflow: hidden; position: fixed; }
        body::before { content: ''; position: fixed; top: -50%; left: -50%; right: -50%; bottom: -50%; background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.06) 20%, rgba(255,255,255,0.02) 40%, rgba(0,0,0,0) 60%, rgba(0,0,0,0.03) 80%, rgba(0,0,0,0.08) 100%); pointer-events: none; z-index: 0; animation: gradient-breath 8s ease-in-out infinite; }
        @keyframes gradient-breath { 0%,100% { transform: scale(1); opacity:1; } 50% { transform: scale(1.1); opacity:0.9; } }
        .app { position: relative; z-index:1; height:100%; display: flex; flex-direction: column; overflow: hidden; }
        .content-wrapper { flex:1; display: flex; flex-direction: column; height:100%; overflow: hidden; }
        .logo-section { flex:1.3; display: flex; align-items: center; justify-content: center; padding: 40px 20px 10px; min-height:0; }
        .logo-wrapper { position: relative; display: flex; align-items: center; justify-content: center; width:240px; height:140px; max-width:100%; }
        .logo-image { max-width:100%; max-height:100%; width:auto; height:auto; object-fit: contain; filter: brightness(0) invert(1); position: relative; z-index:2; }
        .wave-container { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:140px; height:140px; z-index:1; }
        .wave { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:100%; height:100%; border-radius:50%; border:1px solid rgba(255,255,255,0.1); background:transparent; box-shadow:0 0 30px rgba(255,255,255,0.05); pointer-events:none; }
        .wave-1 { animation: wave-flow 4s cubic-bezier(0.4,0,0.2,1) infinite; }
        .wave-2 { animation: wave-flow 4s cubic-bezier(0.4,0,0.2,1) 1.3s infinite; }
        .wave-3 { animation: wave-flow 4s cubic-bezier(0.4,0,0.2,1) 2.6s infinite; }
        @keyframes wave-flow { 0% { transform:translate(-50%,-50%) scale(0.8); opacity:0.3; border-color:rgba(255,255,255,0.15); border-width:1px; } 50% { transform:translate(-50%,-50%) scale(1.8); opacity:0.15; border-color:rgba(255,255,255,0.25); border-width:1.5px; } 100% { transform:translate(-50%,-50%) scale(2.8); opacity:0; border-color:rgba(255,255,255,0.1); border-width:0.5px; } }
        .content-section { flex:2; padding:0 16px 24px; width:100%; display: flex; flex-direction: column; justify-content: flex-end; }
        .actions-container { background:rgba(255,255,255,0.02); border:none; border-radius:28px; padding:24px 20px; backdrop-filter:blur(10px); width:100%; margin-bottom:8px; }
        .status-text { font-size:16px; font-weight:600; color:rgba(255,255,255,0.95); text-align:center; padding:12px 0 16px; border-bottom:1px solid rgba(255,255,255,0.1); margin-bottom:20px; }
        .button { display:block; width:100%; padding:14px; margin:10px 0; border:1px solid rgba(255,255,255,0.25); border-radius:16px; font-size:15px; font-weight:500; cursor:pointer; text-align:center; background:transparent; color:#fff; backdrop-filter:blur(5px); }
        .button:hover { background:rgba(255,255,255,0.08); }
        .button-primary { display:block; width:100%; padding:14px; margin:10px 0; border:none; border-radius:16px; font-size:15px; font-weight:500; cursor:pointer; text-align:center; background:#fff; color:#000; backdrop-filter:blur(5px); }
        .button-primary:hover { background:rgba(255,255,255,0.9); }
        .button.secondary { border-color:rgba(255,255,255,0.2); color:rgba(255,255,255,0.8); font-size:14px; padding:12px; }
        .button-row { display:flex; align-items:center; gap:10px; margin:10px 0; }
        .button-row .button, .button-row .button-primary { flex:1; margin:0; }
        .profile-row { display:flex; align-items:center; gap:10px; margin:10px 0; }
        .profile-row .button { flex:1; margin:0; }
        .faq-button { flex:0.5; display:block; padding:14px; border:1px solid rgba(255,255,255,0.25); border-radius:16px; font-size:15px; font-weight:500; cursor:pointer; text-align:center; background:transparent; color:#fff; margin:0; }
        .faq-button:hover { background:rgba(255,255,255,0.08); }
        .tariff-item { background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.2); border-radius:16px; padding:16px; cursor:pointer; display:flex; align-items:center; justify-content:space-between; color:#fff; }
        .tariff-item:hover { background:rgba(255,255,255,0.08); border-color:#fff; transform:scale(0.98); }
        .tariff-name { font-size:16px; font-weight:500; }
        .tariff-price { font-size:18px; font-weight:600; }
        .tariff-grid { display:flex; flex-direction:column; gap:10px; margin-bottom:20px; }
        .manual-link-container { margin-top:20px; padding:16px; background:rgba(255,255,255,0.02); border-radius:16px; border:1px solid rgba(255,255,255,0.1); }
        .manual-link-title { font-size:14px; color:rgba(255,255,255,0.6); margin-bottom:16px; text-align:center; }
        .copy-button { width:100%; padding:14px; border:1px solid rgba(255,255,255,0.25); border-radius:12px; background:transparent; color:#fff; font-size:14px; cursor:pointer; }
        .copy-button:hover { background:rgba(255,255,255,0.08); }
        .loader { display:inline-block; width:20px; height:20px; border:2px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:#fff; animation:spin 1s ease-in-out infinite; margin-right:8px; vertical-align:middle; }
        @keyframes spin { to { transform:rotate(360deg); } }
        .loading-container { display:flex; align-items:center; justify-content:center; gap:8px; color:rgba(255,255,255,0.7); font-size:14px; }
        h3 { font-size:20px; font-weight:500; margin-bottom:20px; color:#fff; letter-spacing:-0.5px; }
        .info-row { display:flex; justify-content:space-between; padding:14px 0; border-bottom:1px solid rgba(255,255,255,0.1); }
        .info-label { color:rgba(255,255,255,0.6); font-size:14px; }
        .info-value { color:#fff; font-weight:500; font-size:14px; }
        .link { color:#fff; word-break:break-all; text-decoration:underline; text-decoration-color:rgba(255,255,255,0.3); text-underline-offset:4px; font-size:13px; }
        .back-button { margin-top:16px; }
        #deviceHint { font-size:16px; color:#fff; margin-bottom:12px; text-align:center; }
        .hidden { display:none !important; }
        .content-section > div { animation:fadeIn 0.25s ease-out; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }
        .step-indicator { display:flex; align-items:center; justify-content:center; gap:8px; margin-bottom:20px; }
        .step { width:28px; height:28px; border-radius:50%; background:transparent; border:1.5px solid rgba(255,255,255,0.3); display:flex; align-items:center; justify-content:center; font-weight:500; color:rgba(255,255,255,0.6); font-size:14px; }
        .step.active { border-color:#fff; color:#fff; }
        .step-line { flex:1; height:1px; background:rgba(255,255,255,0.2); max-width:30px; }
        p { font-size:14px; line-height:1.5; }
        .back-to-main { margin-top:20px; border-color:rgba(255,255,255,0.2); color:rgba(255,255,255,0.7); }
    </style>
</head>
<body>
    <div class="app">
        <div class="content-wrapper">
            <div class="logo-section">
                <div class="logo-wrapper">
                    <img src="https://raw.githubusercontent.com/marktvencc-hue/omnivpn-webapp/main/photo_5226932146939826416_c.png" alt="OmniVPN" class="logo-image">
                    <div class="wave-container">
                        <div class="wave wave-1"></div>
                        <div class="wave wave-2"></div>
                        <div class="wave wave-3"></div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
                <div id="mainScreen">
                    <div class="actions-container">
                        <div id="statusText" class="status-text"><span class="loader"></span> –ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        <button class="button" onclick="showTariffs()">üí∞ –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
                        <button class="button" onclick="showSetup()">üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</button>
                        <div class="profile-row">
                            <button class="button" onclick="showProfile()">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
                            <button class="faq-button" onclick="openFAQ()">‚ùì FAQ</button>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞—Ä–∏—Ñ—ã -->
                <div id="tariffsScreen" class="hidden">
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h3>
                    <div class="tariff-grid">
                        <div class="tariff-item" onclick="buyTariff('1month')"><span class="tariff-name">1 –º–µ—Å—è—Ü</span><span class="tariff-price">150 ‚≠ê</span></div>
                        <div class="tariff-item" onclick="buyTariff('3months')"><span class="tariff-name">3 –º–µ—Å—è—Ü–∞</span><span class="tariff-price">250 ‚≠ê</span></div>
                        <div class="tariff-item" onclick="buyTariff('6months')"><span class="tariff-name">6 –º–µ—Å—è—Ü–µ–≤</span><span class="tariff-price">350 ‚≠ê</span></div>
                        <div class="tariff-item" onclick="buyTariff('1year')"><span class="tariff-name">1 –≥–æ–¥</span><span class="tariff-price">500 ‚≠ê</span></div>
                    </div>
                    <button class="button secondary back-button" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ -->
                <div id="setupScreen" class="hidden">
                    <h3 id="deviceHint">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h3>
                    <div class="step-indicator">
                        <div class="step" id="step1-indicator">1</div><div class="step-line"></div>
                        <div class="step" id="step2-indicator">2</div><div class="step-line"></div>
                        <div class="step" id="step3-indicator">3</div>
                    </div>
                    <div id="startSetupContainer">
                        <button class="button-primary" onclick="startSetup()">–ù–∞—á–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É</button>
                        <button class="button back-to-main" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
                    </div>
                    <div id="setupSteps" class="hidden">
                        <div id="step1" class="hidden">
                            <p>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Hiddify</p>
                            <div class="button-row">
                                <button class="button-primary" onclick="installApp()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                                <button class="button" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                            </div>
                        </div>
                        <div id="step2" class="hidden">
                            <p>–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</p>
                            <div class="button-row">
                                <button class="button-primary" onclick="addSubscription()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                                <button class="button" onclick="nextStep()">–î–∞–ª–µ–µ ‚Üí</button>
                            </div>
                        </div>
                        <div id="step3" class="hidden">
                            <p>–ì–æ—Ç–æ–≤–æ! –í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ Hiddify</p>
                            <button class="button-primary" onclick="finishSetup()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
                <div id="profileScreen" class="hidden">
                    <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
                    <div class="actions-container">
                        <button class="button" onclick="showReferral()">üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</button>
                        <button class="button" onclick="openSupport()">üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
                        <button class="button" onclick="showTransactions()">üìú –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</button>
                        <button class="button" onclick="openAgreement()">üìÑ –°–æ–≥–ª–∞—à–µ–Ω–∏–µ</button>
                        <button class="button secondary back-button" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
                    </div>
                    <div class="manual-link-container">
                        <div class="manual-link-title">üîó –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</div>
                        <button class="copy-button" onclick="copySubscriptionLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
                    </div>
                </div>

                <!-- –†–µ—Ñ–µ—Ä–∞–ª—ã -->
                <div id="referralScreen" class="hidden">
                    <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                    <p>–ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ 15% –±–æ–Ω—É—Å–Ω—ã—Ö –¥–Ω–µ–π –æ—Ç –µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π.</p>
                    <div id="referralInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <button class="button secondary back-button" onclick="backToProfile()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
                <div id="transactionsScreen" class="hidden">
                    <h3>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
                    <div id="transactionsList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <button class="button secondary back-button" onclick="backToProfile()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://omnivpn.us.ci';
        const SUPPORT_BOT_USERNAME = 'SupportBot';
        const USER_AGREEMENT_URL = 'https://telegra.ph/User-Agreement';
        const FAQ_URL = 'https://telegra.ph/FAQ-OmniVPN-01';

        // –°—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ Hiddify
        const APP_LINKS = {
            android: 'https://app.hiddify.com/play',
            ios: 'https://app.hiddify.com/ios',
            ipados: 'https://app.hiddify.com/ios',
            windows: 'https://app.hiddify.com/windows',
            macos: 'https://app.hiddify.com/mac',
            linux: 'https://app.hiddify.com/linux'
        };

        if (!window.Telegram || !window.Telegram.WebApp) {
            document.body.innerHTML = '<div style="padding:20px;text-align:center;color:white;background:black;">‚ùå –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram</div>';
            throw new Error('Not in Telegram');
        }

        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.setHeaderColor('#000000');
        tg.setBackgroundColor('#000000');

        let currentStep = 1;
        let currentSubscriptionUrl = '';

        async function fetchWithAuth(url, options = {}) {
            options.headers = { ...options.headers, 'X-Telegram-Init-Data': tg.initData || '' };
            const response = await fetch(url, options);
            if (!response.ok) {
                const error = await response.json().catch(() => ({}));
                throw new Error(error.error || `HTTP ${response.status}`);
            }
            return response.json();
        }

        function showScreen(screenId) {
            document.querySelectorAll('#mainScreen, #tariffsScreen, #setupScreen, #profileScreen, #referralScreen, #transactionsScreen').forEach(el => el.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            if (screenId === 'setupScreen') resetSetupScreen();
        }

        function resetSetupScreen() {
            document.getElementById('startSetupContainer').style.display = 'block';
            document.getElementById('setupSteps').classList.add('hidden');
            ['step1','step2','step3'].forEach(id => document.getElementById(id).classList.add('hidden'));
            currentStep = 1;
            updateStepIndicators(1);
        }

        function backToMain() { showScreen('mainScreen'); loadStatus(); }
        function backToProfile() { showScreen('profileScreen'); }

        function updateStepIndicators(step) {
            document.querySelectorAll('.step').forEach((el, i) => {
                if (i+1 === step) el.classList.add('active'); else el.classList.remove('active');
            });
        }

        async function loadStatus() {
            try {
                const data = await fetchWithAuth(API_URL + '/api/user_status');
                document.getElementById('statusText').innerText = data.subscription_end
                    ? `–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –¥–æ ${new Date(data.subscription_end).toLocaleDateString()}`
                    : '–ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ ‚Ä¢ 3 –¥–Ω—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ';
                currentSubscriptionUrl = data.subscription_url || '';
            } catch (e) {
                document.getElementById('statusText').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
            }
        }

        async function copySubscriptionLink() {
            if (!currentSubscriptionUrl) { alert('–°—Å—ã–ª–∫–∞ –µ—â—ë –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞'); return; }
            try { await navigator.clipboard.writeText(currentSubscriptionUrl); alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'); }
            catch { alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'); }
        }

        function showTariffs() { showScreen('tariffsScreen'); }
        function showProfile() { showScreen('profileScreen'); }
        function showSetup() { showScreen('setupScreen'); document.getElementById('deviceHint').innerText = `–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ ${tg.platform || 'unknown'}`; }
        function showReferral() { showScreen('referralScreen'); loadReferralInfo(); }
        function showTransactions() { showScreen('transactionsScreen'); loadTransactions(); }

        async function buyTariff(tariff) {
            try {
                const data = await fetchWithAuth(API_URL + '/api/create_invoice', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tariff })
                });
                if (data.invoice_link) tg.openInvoice(data.invoice_link);
                else alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—á—ë—Ç–∞');
            } catch (e) { alert('–û—à–∏–±–∫–∞: ' + e.message); }
        }

        async function loadReferralInfo() {
            try {
                const data = await fetchWithAuth(API_URL + '/api/referral_info');
                let html = `<div class="info-row"><span class="info-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π:</span> <span class="info-value">${data.count}</span></div>`;
                html += `<div class="info-row"><span class="info-label">–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</span> <span class="link">${data.link}</span></div>`;
                html += `<h4 style="margin:24px 0 16px;">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</h4>`;
                if (data.history.length === 0) html += '<p style="color:rgba(255,255,255,0.6);">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</p>';
                else data.history.forEach(item => {
                    const date = new Date(item.created_at).toLocaleDateString();
                    html += `<div class="info-row"><span class="info-label">${date}</span> <span class="info-value">+${item.bonus_days} –¥–Ω–µ–π</span></div>`;
                });
                document.getElementById('referralInfo').innerHTML = html;
            } catch { document.getElementById('referralInfo').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'; }
        }

        async function loadTransactions() {
            try {
                const trans = await fetchWithAuth(API_URL + '/api/transactions');
                let html = '';
                if (trans.length === 0) html = '<p style="color:rgba(255,255,255,0.6);">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>';
                else trans.forEach(t => {
                    const date = new Date(t.created_at).toLocaleDateString();
                    html += `<div class="info-row"><span class="info-label">${date} (${t.tariff})</span> <span class="info-value">${t.amount_stars} ‚≠ê</span></div>`;
                });
                document.getElementById('transactionsList').innerHTML = html;
            } catch { document.getElementById('transactionsList').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'; }
        }

        function startSetup() {
            document.getElementById('startSetupContainer').style.display = 'none';
            document.getElementById('setupSteps').classList.remove('hidden');
            document.getElementById('step1').classList.remove('hidden');
            updateStepIndicators(1);
        }

        function installApp() {
            tg.openLink(APP_LINKS[tg.platform] || APP_LINKS.android);
            nextStep();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ deep link Hiddify
        async function addSubscription() {
            if (!currentSubscriptionUrl) {
                alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É –µ—â—ë –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞');
                return;
            }

            const btn = document.querySelector('#step2 .button-primary');
            const originalText = btn.innerText;
            btn.innerText = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            btn.disabled = true;

            try {
                // –°–æ–∑–¥–∞—ë–º deep link –¥–ª—è Hiddify
                const encodedUrl = encodeURIComponent(currentSubscriptionUrl);
                const hiddifyLink = `hiddify://import/${encodedUrl}`;
                
                // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å deep link
                window.location.href = hiddifyLink;
                
                // –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É 3
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                    nextStep();
                }, 2000);
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
                btn.innerText = '‚ûï –î–æ–±–∞–≤–∏—Ç—å';
                btn.disabled = false;
            }
        }

        function nextStep() {
            if (currentStep === 1) {
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                currentStep = 2;
                updateStepIndicators(2);
            } else if (currentStep === 2) {
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.remove('hidden');
                currentStep = 3;
                updateStepIndicators(3);
            }
        }

        function finishSetup() { backToMain(); }
        function openSupport() { tg.openTelegramLink('https://t.me/' + SUPPORT_BOT_USERNAME); }
        function openAgreement() { tg.openLink(USER_AGREEMENT_URL); }
        function openFAQ() { tg.openLink(FAQ_URL); }

        loadStatus();
    </script>
</body>
</html>
